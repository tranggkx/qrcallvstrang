<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thanh toán QR</title>
  <link rel="preconnect" href="https://img.vietqr.io">
  <style>
    :root{
      --bg:#020617;
      --card:#0b1120;
      --muted:#9ca3af;
      --ink:#e5e7eb;
      --border:#1f2937;
      --brand:#059669;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Segoe UI",Roboto,Arial,sans-serif;
      background:radial-gradient(circle at top,#111827 0,#020617 55%);
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .wrap{max-width:980px;width:100%;}
    .card{
      background:var(--card);
      border-radius:24px;
      padding:32px 28px 28px;
      border:1px solid rgba(148,163,184,.2);
      box-shadow:0 30px 70px rgba(0,0,0,.6);
    }
    .title{
      text-align:center;font-size:24px;
      font-weight:700;line-height:1.4;margin-bottom:24px;
    }
    .grid{
      display:grid;
      grid-template-columns:minmax(280px,420px) minmax(260px,320px);
      gap:24px;align-items:flex-start;
    }
    @media(max-width:900px){.grid{grid-template-columns:1fr;}}

    .qr-box{
      background:#020617;border-radius:18px;
      border:1px dashed var(--border);
      height:360px;display:flex;
      align-items:center;justify-content:center;
      position:relative;overflow:hidden;
    }
    .qr-box img{
      max-width:95%;
      max-height:95%;
      display:block;
    }
    .qr-placeholder{
      position:absolute;inset:0;
      display:flex;align-items:center;
      justify-content:center;color:var(--muted);
      font-size:15px;pointer-events:none;
    }

    .info-row{
      display:grid;grid-template-columns:auto 1fr auto;
      align-items:center;column-gap:12px;
      margin-bottom:10px;font-size:15px;
    }
    .info-label{color:var(--muted);}
    .info-value{text-align:right;font-weight:500;}

    .btn-copy{
      padding:6px 12px;border-radius:999px;
      border:1px solid var(--border);
      background:#020617;color:var(--ink);
      font-size:13px;cursor:pointer;transition:.12s;
    }
    .btn-copy:hover{background:#111827;border-color:var(--brand);}
    .btn-copy:active{transform:scale(.97);}

    .action-row{margin-top:20px;display:flex;gap:12px;}
    .amount-input{
      flex:1;padding:12px 14px;border-radius:999px;
      border:1px solid var(--border);
      background:#020617;color:var(--ink);font-size:14px;
    }
    .amount-input:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 1px rgba(34,197,94,.25);
    }
    .btn-primary{
      padding:12px 18px;border-radius:999px;border:none;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#ecfdf5;font-weight:600;font-size:14px;
      cursor:pointer;white-space:nowrap;
      box-shadow:0 12px 30px rgba(34,197,94,.25);
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="title">
      Thanh toán QR để được gọi video với em Lê<br>Thị Trang
    </div>

    <div class="grid">

      <!-- QR ONLY -->
      <div>
        <div class="qr-box">
          <img id="qrImage" alt="" style="display:none;">
          <div id="qrPlaceholder" class="qr-placeholder">
            QR sẽ hiển thị ở đây
          </div>
        </div>
      </div>

      <!-- INFO -->
      <div>

        <div class="info-row">
          <div class="info-label">Ngân hàng:</div>
          <div id="bankName" class="info-value">OCB</div>
          <button class="btn-copy" data-copy="bankName">Copy</button>
        </div>

        <div class="info-row">
          <div class="info-label">Số TK:</div>
          <div id="accountNumber" class="info-value">0030104444444444</div>
          <button class="btn-copy" data-copy="accountNumber">Copy</button>
        </div>

        <div class="info-row">
          <div class="info-label">Số tiền:</div>
          <div id="amountText" class="info-value">—</div>
          <button class="btn-copy" data-copy="amountText">Copy</button>
        </div>

        <div class="info-row">
          <div class="info-label">Nội dung:</div>
          <div id="descriptionText" class="info-value">—</div>
          <button class="btn-copy" data-copy="descriptionText">Copy</button>
        </div>

        <div class="action-row">
          <!-- đổi type="text" để format 20.000 -->
          <input id="amountInput" class="amount-input" type="text" placeholder="Nhập số tiền (VND)">
          <button id="btnCreate" class="btn-primary">Tạo QR</button>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
const BANK_CODE    = "OCB";
const ACCOUNT_NO   = "0030104444444444";
const ACCOUNT_NAME = "LE THI TRANG";

const amountInput      = document.getElementById("amountInput");
const amountText       = document.getElementById("amountText");
const descriptionText  = document.getElementById("descriptionText");
const qrImage          = document.getElementById("qrImage");
const qrPlaceholder    = document.getElementById("qrPlaceholder");
const btnCreate        = document.getElementById("btnCreate");

function formatCurrency(v){
  v = Number(v || 0);
  if(!v) return "";
  return v.toLocaleString("vi-VN"); // 20000 -> 20.000
}

// đọc số từ ô input (bỏ hết ký tự không phải số)
function getAmountFromInput(){
  const raw = amountInput.value.replace(/[^\d]/g,"");
  return raw ? Number(raw) : 0;
}

// format ngay khi gõ
function handleAmountInput(){
  const raw = amountInput.value.replace(/[^\d]/g,"");
  if(!raw){
    amountInput.value = "";
    return;
  }
  const num = Number(raw);
  amountInput.value = formatCurrency(num);
}

amountInput.addEventListener("input", handleAmountInput);

function generateDescription(){
  const now = new Date();
  const y = now.getFullYear();
  const m = String(now.getMonth()+1).padStart(2,"0");
  const d = String(now.getDate()).padStart(2,"0");
  const rand = Math.floor(1000 + Math.random()*9000);
  return `HD${y}${m}${d}-${rand}`;
}

function buildQrUrl(amount, description){
  // QR ONLY – chỉ mã QR, không logo/chữ
  const base = `https://img.vietqr.io/image/${BANK_CODE}-${ACCOUNT_NO}-qr_only.png`;
  const params = new URLSearchParams({
    amount: amount,
    addInfo: description,
    accountName: ACCOUNT_NAME
  });
  return `${base}?${params.toString()}`;
}

btnCreate.addEventListener("click", () => {
  const amount = getAmountFromInput();
  if(!amount || amount <= 0){
    alert("Nhập số tiền hợp lệ.");
    return;
  }

  const desc = generateDescription();
  amountText.textContent = `${formatCurrency(amount)} VND`;
  descriptionText.textContent = desc;

  const qrUrl = buildQrUrl(amount, desc);
  qrImage.src = qrUrl;
  qrImage.style.display = "block";
  qrPlaceholder.style.display = "none";
});

document.querySelectorAll(".btn-copy").forEach(btn => {
  btn.addEventListener("click", () => {
    const id = btn.getAttribute("data-copy");
    const val = document.getElementById(id).textContent;
    if(!val || val === "—"){
      alert("Chưa có dữ liệu để copy.");return;
    }
    navigator.clipboard.writeText(val);
    btn.textContent = "Đã copy";
    setTimeout(()=>btn.textContent="Copy",900);
  });
});
</script>

</body>
</html>